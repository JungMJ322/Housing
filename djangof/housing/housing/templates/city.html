<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gothic+A1:wght@100;200;300;400;500;600;700;800;900&&family=Noto+Sans+KR:wght@100;400;500&display=swap" rel="stylesheet">
    <script>
        function make_pie(data, chartName){
            var series = [data]
            var chart = {
                   plotBackgroundColor: null,
                   plotBorderWidth: null,
                   plotShadow: false
            };
            var title = {
                  text: chartName
            };
            var tooltip = {
                    pointFormat: '<b>{point.percentage:.1f}%</b>'
            };
            var plotOptions = {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: false,
                            format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                            style: {
                                color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                            }
                        },
                            showInLegend: true,
                            innerSize:100
                    }
                };
            var json = {}
            json.chart = chart;
            json.title = title;
            json.tooltip = tooltip;
            json.plotOptions = plotOptions;
            json.series = series
            return json
            }

            function make_half_pie(data, chartName){
            var series = [data]
            var chart = {
                   plotBackgroundColor: null,
                   plotBorderWidth: null,
                   plotShadow: false
            };
            var title = {
                  text: chartName
            };
            var tooltip = {
                    pointFormat: '<b>{point.percentage:.1f}%</b>'
            };
            var plotOptions = {
                    pie: {
                        dataLabels: {
                            enabled: true,
                            distance: -50,
                            style: {
                                fontWeight: 'bold',
                            }
                        },
                        startAngle: -90,
                        endAngle: 90,
                        center: ['50%', '75%'],
                        size: '110%',
                        showInLegend: true,
                        innerSize:100
                    }
                };
            var json = {}
            json.chart = chart;
            json.title = title;
            json.tooltip = tooltip;
            json.plotOptions = plotOptions;
            json.series = series
            return json
            }

        function make_bar(chart_name, subtitle, categories, data) {
            var title = {
                text: chart_name
            }
            var subtitle = {
                text: subtitle
            }
            var xAxis = {
                categories: categories
            }
            var yAxis = {
                min: 0,
                title: {
                    text: 'House_Supply'
                }
            }
            var tooltip = {
                headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                pointFormat: '<tr><td style="color:{series.color};padding:0"></td>' +
                    '<td style="padding:0"><b>{point.y} 가구</b></td></tr>',
                footerFormat: '</table>',
                shared: true,
                useHTML: true
            }
            var series = [data]
            var json = {}
            json.tooltip = tooltip
            json.title = title
            json.subtitle = subtitle
            json.xAxis = xAxis
            json.yAxis = yAxis
            json.series = series
            return json
            }

        function make_bars(chart_name, subtitle, x_cat, y_name, data) {
                var temp = {
                        chart: {
                            type: 'column'
                        },
                        title: {
                            text: chart_name
                        },
                        subtitle: {
                            text: subtitle
                        },
                        xAxis: {
                            categories: x_cat,
                            crosshair: true
                        },
                        yAxis: {
                            min: 0,
                            title: {
                                text: y_name
                            }
                        },
                        tooltip: {
                            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                                '<td style="padding:0"><b>{point.y} 개 </b></td></tr>',
                            footerFormat: '</table>',
                            shared: true,
                            useHTML: true
                        },
                        plotOptions: {
                            column: {
                                pointPadding: 0.2,
                                borderWidth: 0
                            }
                        },
                        series: data
                    }
                    return temp 
                }

        function make_line(chart_name, subtitle, x_cat, y_name, data) {
            var json = {
                    title: {
                        text: chart_name
                        },
                    subtitle: {
                        text: subtitle
                        },
                    yAxis: {
                        title: {
                            text: y_name
                            }
                        },
                    xAxis: {
                        categories: x_cat
                    },
                    legend: {
                        layout: 'vertical',
                        align: 'right',
                        verticalAlign: 'middle'
                    },
                    plotOptions: {
                        series: {
                            label: {
                                connectorAllowed: false
                            }
                            
                        }
                    },
                    series: data,
                    responsive: {
                    rules: [{
                        condition: {
                            maxWidth: 300
                        },
                        chartOptions: {
                            legend: {
                                layout: 'horizontal',
                                align: 'left',
                                verticalAlign: 'bottom'
                            }
                        }
                    }]
                }
            }
        return json
        }

        function ajax_module(data_dict) {
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                $.ajax({
                    url:'/requestJson/',
                    type:"POST",
                    dataType:'json',
                    data:data_dict,
                    headers:{"X-CSRFToken": "{{ csrf_token }}"},
                    success:function(data) {
                        resolve(data)
                    },
                    error:function(data, error) {
                        reject(data, error)
                        }
                    })
                }, 0)
            })
        }

        function sido_json(data_dict) {
            ajax_module(data_dict).then((data) => {
                    if(data['type'] == 'first'){
                        temp1 = make_pie(data['fst'], 'Total Infra Rate')
                        $('#data2').highcharts(temp1)

                        temp_3 = make_line('House Supply of Quarters', '', ['2020-1q','2020-2q','2020-3q','2020-4q','2021-1q','2021-2q','2021-3q','2021-4q','2022-1q', '2022-2q'], 'Supply size', data['trd'])
                        $('#data3').highcharts(temp_3)

                    }
                    if(data['type'] == 'second'){
                        temp = make_line('Sold Cost Mean of Quarters', '', ['2020-1q','2020-2q','2020-3q','2020-4q','2021-1q','2021-2q','2021-3q','2021-4q','2022-1q'],'sold_cost', data['fst'])
                        $('#data5').highcharts(temp)
                        // console.log(data)
                        temp_2 = make_bar('Area Supply Size', '', data['snd'][0]['gu_list'], data['snd'][0]['data'])
                        $('#data6').highcharts(temp_2)

                    }
                    if(data['type'] == 'third'){
                        temp3 = make_pie(data['trd'], 'School type')
                        $('#data9').highcharts(temp3)
                        temp_4 = make_half_pie(data['fth'], 'Achieved Underachieved Count')
                        $('#data7').highcharts(temp_4)
                        temp4 = make_pie(data['fiveth'], 'Park type')
                        $('#data8').highcharts(temp4)
                        temp2 = make_bars('Area Infra Count', '', data['sixth_list'], 'Infra Count', data['sixth_data'])
                        Highcharts.chart('data10', temp2)
                    }
                }).catch((data, error) => {
                    console.log(error)
            })
        }

        $(function(){
            temp = location.href.split("?")
            data_sido = temp[1].split('=')
            sido_name = decodeURI(data_sido[1])
            console.log(sido_name)
            var data_dict1 = {'sidoname': sido_name, 'tabNo': 1}
            sido_json(data_dict1)
            var data_dict2 = {'sidoname': sido_name, 'tabNo': 2}
            sido_json(data_dict2)
            var data_dict3 = {'sidoname': sido_name, 'tabNo': 3}
            sido_json(data_dict3)
        })
    </script>
    <style>

        *{
          margin: 0;
          padding:0;
        }

        body {
            font-family: plain,"Helvetica Neue",Helvetica,Arial,sans-serif;
            font-weight: 400;
            color: #000;
            font-size: 17px;
        }
        #home{
            position:absolute;
            height: 30px;
            font-size: 30px;
            margin: 7px 2px 0px 5%;
            color:whitesmoke;
            background-color:rgb(211, 218, 224);
            cursor: pointer;
            border: none;
            outline: none;
            padding:0;
        }

        #contentWrapper{
            text-align: center;
            width: 100%;
            height: 100%;
            background-color: rgb(211, 218, 224);
            padding: 0px 20px;
        }


        #board{
            height: 100%;
            width:100%;
        }

        #databox{
            height: 90%;
        }
        #bar{
            display: absolute;
            width: 96%;
            background-color: whitesmoke;
            height: 3px;
            margin-top: 0px;
            margin-left: 2%;
        }
        .box{
            flex-direction:column;
            margin: 0;
            display: none;
        }
        #mapbox{
            display:flex;
            flex:1;
            border-radius: 10px;
            margin:5px 5px 8px 5px;
            box-shadow: 0 2.8px 2.2px rgba(0, 0, 0, 0.034),
            0 6.7px 5.3px rgba(0, 0, 0, 0.048),
            0 12.5px 10px rgba(0, 0, 0, 0.06),
            0 22.3px 17.9px rgba(0, 0, 0, 0.072),
            0 41.8px 33.4px rgba(0, 0, 0, 0.086),
            0 100px 80px rgba(0, 0, 0, 0.12);
        }
        #map{
            flex:1;
            height:100%;
            width:100%;
            overflow:hidden;
        }

        .table{
            flex:1;
            display: flex;
            flex-direction: row;
        }
        /*#t1{
            margin-top: 0;
        }*/
        .data{
            margin: 5px 5px 8px 5px;
            border-radius: 10px;
            flex:1;
            background-color: whitesmoke;
            text-align: center;
            box-shadow:
            0 2.8px 2.2px rgba(0, 0, 0, 0.034),
            0 6.7px 5.3px rgba(0, 0, 0, 0.048),
            0 12.5px 10px rgba(0, 0, 0, 0.06),
            0 22.3px 17.9px rgba(0, 0, 0, 0.072),
            0 41.8px 33.4px rgba(0, 0, 0, 0.086),
            0 100px 80px rgba(0, 0, 0, 0.12);
        }
        #data1{
            display:flex;
            flex-direction: column;
            background-color:transparent;
            box-shadow: none;
            flex:1;
        }
        .rank{
            border-radius: 10px;
            flex:1;
            margin-top:2px;
            background-color: white;
            opacity: 0.9;
            text-align: center;
            box-shadow:
            0 2.8px 2.2px rgba(0, 0, 0, 0.034),
            0 6.7px 5.3px rgba(0, 0, 0, 0.048),
            0 12.5px 10px rgba(0, 0, 0, 0.06),
            0 22.3px 17.9px rgba(0, 0, 0, 0.072),
            0 41.8px 33.4px rgba(0, 0, 0, 0.086),
            0 100px 80px rgba(0, 0, 0, 0.12);
            color: #2c2c2c;
            font-family: Gothic A1, sans-serfif;
            /* font-family: 'Noto Sans KR', sans-serif; */
            font-weight: 500;
            line-height: 30px;
            display:flex;
            max-height: 75px
        }

        .rtitle{margin:auto; font-weight: 600; font-size: 25px; color:#3A3A3A;}

        .rt{
            margin:auto;
            text-align:center;
            width:85%;
            display: flex;
            flex-direction:row;
        }
        .rt div{flex:4;}
        span{ flex:1; }
        .rc{color:#383F93;}


        #data7{
            flex:2;
        }


        input[type="radio"] {display: none;}
        input[type="radio"] + label {
            display: inline-block;
            margin:10px 0px 0px 0px;
            padding: 5px 30px;
            width: 200px;
            background-color: #ccc;
            color: black;
            cursor: pointer;
            text-transform: uppercase;
        }
        input[type="radio"]:checked + label {background: ghostwhite ;color: #000;}


        input[id="nav1"]:checked ~ .tab1 {display: flex;}
        input[id="nav2"]:checked ~ .tab2 {display: flex;}
        input[id="nav3"]:checked ~ .tab3 {display: flex;}


    </style>
    <script>
        $(function(){
            $('#map > div > div').css({'padding-bottom':'100%'})
        })
    </script>
</head>

<body>
    <button id="home"><a href="/"><ion-icon name="home-outline"></ion-icon></a></button>
    <div id = "contentWrapper">
        <div id ="board">
            <div id="databox">
                <input type="radio" id="nav1" name="tab" checked>
                <label for="nav1">label1</label>
                <input type="radio" id="nav2" name="tab">
                <label for="nav2">label2</label>
                <input type="radio" id="nav3" name="tab">
                <label for="nav3">label3</label>
                <div id="bar"></div>
                <div class="box tab1">
                    <div class="table" id="t1">
                        <div id="mapbox">
                            <div class="folium-map" id="map">
                                {{ map|safe }}
                            </div>
                        </div>

                        <div class="data" id="data1">
                            <div class="rank"><div class="rtitle">청약 경쟁률 TOP 5</div></div>
                            <div class="rank"><div class="rt"><span>{{ rank1.rank }}위</span><div>{{ rank1.name }}</div><span class="rc">{{ rank1.compet }}</span></div></div>
                            <div class="rank"><div class="rt"><span>{{ rank2.rank }}위</span><div>{{ rank2.name }}</div><span class="rc">{{ rank2.compet }}</span></div></div>
                            <div class="rank"><div class="rt"><span>{{ rank3.rank }}위</span><div>{{ rank3.name }}</div><span class="rc">{{ rank3.compet }}</span></div></div>
                            <div class="rank"><div class="rt"><span>{{ rank4.rank }}위</span><div>{{ rank4.name }}</div><span class="rc">{{ rank4.compet }}</span></div></div>
                            <div class="rank"><div class="rt"><span>{{ rank5.rank }}위</span><div>{{ rank5.name }}</div><span class="rc">{{ rank5.compet }}</span></div></div>
                        </div>
                        <div class="data" id="data2">plot</div>

                    </div>

                    <div class="table">
                        <div class="data" id="data3">plot</div>
                    </div>
                </div>
                <div class="box tab2">
                    <div class="table" id="t2">
                        <div class="data" id="data5"></div>
                    </div>

                    <div class="table">
                        <div class="data" id="data6"></div>
                    </div>
                </div>
                <div class="box tab3">
                    <div class="table" id="t3">
                        <div class="data" id="data7"></div>
                        <div class="data" id="data8"></div>
                        <div class="data" id="data9"></div>
                    </div>
                    <div class="table">
                        <div class="data" id="data10"></div>
                    </div>

                </div>
            </div>
        </div>
    </div>


    <div id = "line"></div>



    
</body>
</html>