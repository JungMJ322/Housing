<html>
<head>
<meta charset="UTF-8" />
<title>detail</title>
<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script>
</head>
<body>
<div id="container" style="width: 300px; height: 300px; margin: 0 auto"></div>
<script language="JavaScript">
    function make_pie(data, chartName){
        var series = [data]
        var chart = {
               plotBackgroundColor: null,
               plotBorderWidth: null,
               plotShadow: false
        };
        var title = {
              text: chartName
        };
        var tooltip = {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        };
        var plotOptions = {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {  
                        enabled: false,
                        format: '<b>{point.name}%</b>: {point.percentage:.1f} %',
                        style: {
                            color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                        }
                    }
                }
            };
        var json = {}
        json.chart = chart;
        json.title = title;     
        json.tooltip = tooltip;  
        json.plotOptions = plotOptions;
        json.series = series
        return json
        
    }

    function make_bar() {
        
    }

    function ajax_sido(sidoName) {
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                $.ajax({
                    url:'requestJson/',
                    type:"POST",
                    dataType:'json',
                    data:sidoName,
                    headers:{"X-CSRFToken": "{{ csrf_token }}"},
                    success:function(data) {
                        resolve(data)
                    },
                    error:function(data, error) {
                        reject(data, error)
                    }
                })
            }, 0)
        })
    }

    function sido_json(sido, name) {
        ajax_sido(sido).then((data) => {
            json = make_pie(data, name)
            $("#container").highcharts(json)
        }).catch((data, error) => {
            console.log(error)
        })
    }

    $(function(){
        want_find = {'sidoname' : '부산'}
        sido_json(want_find, want_find.sidoname)
    })
</script>
</body>
</html>
